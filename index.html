<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TITAN V13 - MAHADHARE GOLD ULTIMATE</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0a0a0a">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Space+Grotesk:wght@300;500;700&display=swap');
        :root { --gold: #ffd700; --emerald: #10b981; --glass: rgba(10, 10, 18, 0.98); }
        body { background: #020308; color: #e2e8f0; font-family: 'Space Grotesk', sans-serif; overflow: hidden; height: 100vh; user-select: none; }
        .titan-font { font-family: 'Orbitron', sans-serif; }
        .glass-premium { background: var(--glass); backdrop-filter: blur(25px); border: 1px solid rgba(255, 215, 0, 0.15); border-radius: 1.5rem; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .blink-execute { animation: blink-gold 1.5s infinite; }
        @keyframes blink-gold { 0%, 100% { border-color: rgba(255,215,0,0.1); } 50% { border-color: var(--gold); box-shadow: 0 0 20px rgba(255,215,0,0.3); } }
        #face-video { width: 100%; height: 180px; border-radius: 1rem; object-fit: cover; border: 2px solid var(--gold); background: #000; margin-bottom: 10px; }
        .floating-msg { position: fixed; top: 110px; right: 20px; z-index: 9999; background: rgba(0,0,0,0.9); padding: 12px 20px; border-radius: 12px; border: 1px solid var(--gold); font-size: 10px; animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .btn-gold { background: linear-gradient(135deg, #ffd700 0%, #b8860b 100%); color: black; font-weight: 900; text-transform: uppercase; }
    </style>
</head>
<body class="no-scrollbar">

<div id="notif-area"></div>
<div id="master-trigger" onclick="handleMasterBypass()" class="fixed top-0 left-0 w-16 h-16 z-[10002] opacity-0 cursor-pointer"></div>

<div id="auth-screen" class="fixed inset-0 z-[10000] bg-[#020308] flex flex-col items-center justify-center p-6 text-center">
    <div class="w-full max-w-sm">
        <div class="relative inline-block mb-8">
            <div class="w-32 h-32 glass-premium flex items-center justify-center border-2 border-yellow-500 mx-auto shadow-[0_0_50px_rgba(255,215,0,0.2)]">
                <i class="fa-solid fa-crown text-5xl text-yellow-500"></i>
            </div>
            <div class="absolute -bottom-2 -right-2 bg-yellow-500 text-black text-[10px] font-black px-2 py-1 rounded titan-font shadow-lg uppercase">V.13</div>
        </div>
        <h1 class="titan-font text-2xl text-yellow-500 mb-8 font-black tracking-widest uppercase">Mahadhare Gold</h1>
        <div class="space-y-4" id="auth-box">
            <input type="text" id="auth-phone" placeholder="CHAT ID TELEGRAM" class="w-full bg-white/5 p-4 rounded-xl border border-white/10 outline-none focus:border-yellow-500 text-white text-center">
            <div id="biometric-mod" class="hidden space-y-2">
                <video id="face-video" class="hidden" autoplay muted playsinline></video>
                <button onclick="startFaceScan()" id="scan-btn" class="w-full py-4 bg-blue-600 rounded-xl text-[10px] titan-font shadow-lg uppercase font-bold tracking-widest text-white"><i class="fa-solid fa-face-viewfinder mr-2"></i> Jalankan Scan Wajah</button>
            </div>
            <input type="password" id="auth-pass" placeholder="PASSWORD" class="w-full bg-white/5 p-4 rounded-xl border border-white/10 outline-none focus:border-yellow-500 text-white text-center">
            <div class="grid grid-cols-2 gap-3">
                <button onclick="handleAuth()" class="btn-gold w-full py-4 rounded-xl titan-font text-[10px]">Login</button>
                <button onclick="toggleAuth()" id="toggle-btn" class="py-4 bg-white/5 border border-white/10 text-white titan-font text-[10px] rounded-xl uppercase">Daftar</button>
            </div>
        </div>
    </div>
</div>

<div id="disclaimer-elite" class="fixed inset-0 z-[10001] flex items-center justify-center p-6 hidden">
    <div class="absolute inset-0 bg-black/98 backdrop-blur-3xl"></div>
    <div class="glass-premium p-8 w-full max-w-md border-yellow-500/50 relative">
        <h2 class="titan-font text-yellow-500 text-sm mb-4 uppercase text-center font-black">Digital Disclaimer Agreement</h2>
        <div class="text-[10px] text-white/70 h-64 overflow-y-auto pr-2 mb-6 leading-relaxed space-y-4 no-scrollbar text-left">
            <p>1. Saya memahami trading crypto memiliki risiko modal tinggi.</p>
            <p>2. Saya wajib menyinkronkan saldo riil Indodax dengan nominal APK agar TSL Guard bekerja.</p>
            <p>3. Saya tidak akan menyebarluaskan sinyal eksklusif TITAN.</p>
            <p>4. Saya menyetujui masa bakti 180 hari sebelum akses API Level 3.</p>
        </div>
        <button onclick="acceptDisclaimer()" class="btn-gold w-full py-4 rounded-xl titan-font text-[10px]">Setuju & Aktifkan</button>
    </div>
</div>

<header class="p-4 flex justify-between items-center bg-black border-b border-white/5 sticky top-0 z-50">
    <div class="flex items-center gap-3">
        <div id="mode-indicator" class="bg-white/5 p-2 px-4 rounded-2xl border border-white/10 flex items-center gap-2">
            <div id="mode-dot" class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></div>
            <span id="mode-text" class="titan-font text-[9px] uppercase text-white font-bold">Standard Mode</span>
        </div>
        <button id="master-switch-btn" onclick="masterStatusToggle()" class="hidden bg-yellow-500/20 text-yellow-500 p-2 px-4 rounded-xl text-[9px] titan-font border border-yellow-500/30 uppercase font-black">Elite Switch</button>
    </div>
    <div class="flex items-center gap-4 text-yellow-500">
        <button onclick="showTutorial()"><i class="fa-solid fa-robot text-xl"></i></button>
        <button onclick="saveAndExit()"><i class="fa-solid fa-power-off text-xl text-rose-500"></i></button>
    </div>
</header>

<main class="p-4 h-full overflow-y-auto pb-48 no-scrollbar">
    <section class="glass-premium p-6 mb-8 relative overflow-hidden">
        <div class="flex justify-between items-start mb-1">
            <p class="text-[9px] uppercase opacity-40 tracking-widest text-white">Equity Balance (Auto-Compound)</p>
            <div id="roadmap-box" class="hidden flex flex-col items-end">
                <p class="text-[7px] text-emerald-400 font-black titan-font uppercase">Roadmap Level 3</p>
                <p id="elite-tenure" class="text-[8px] text-blue-400 font-bold titan-font">180 DAYS LEFT</p>
            </div>
        </div>
        <h2 id="cap-main" class="titan-font text-4xl text-yellow-500 font-black mb-6">Rp 0</h2>
        <div class="grid grid-cols-3 gap-3">
            <div class="bg-white/5 p-3 rounded-2xl border border-white/5 text-center">
                <p class="text-[7px] opacity-40 mb-1 uppercase">Scalp (40%)</p>
                <p id="b-scalp" class="text-[10px] font-black text-emerald-400">Rp 0</p>
            </div>
            <div class="bg-white/5 p-3 rounded-2xl border border-white/5 text-center">
                <p class="text-[7px] opacity-40 mb-1 uppercase">Smart (40%)</p>
                <p id="b-smart" class="text-[10px] font-black text-blue-400">Rp 0</p>
            </div>
            <div class="bg-white/5 p-3 rounded-2xl border border-white/5 text-center">
                <p class="text-[7px] opacity-40 mb-1 uppercase">Moon (20%)</p>
                <p id="b-moon" class="text-[10px] font-black text-violet-400">Rp 0</p>
            </div>
        </div>
    </section>

    <section class="grid grid-cols-3 gap-4 h-[55vh]">
        <div>
            <h3 class="titan-font text-[9px] text-yellow-500 mb-4 uppercase text-center font-black tracking-widest">Analysis</h3>
            <div id="list-analysis" class="space-y-4 overflow-y-auto no-scrollbar h-full"></div>
        </div>
        <div>
            <h3 class="titan-font text-[9px] text-blue-500 mb-2 uppercase text-center font-black tracking-widest">Execution</h3>
            <div id="slot-indicator" class="text-center text-[8px] opacity-50 titan-font mb-2 uppercase font-black">Slots: 0/10</div>
            <div id="list-execution" class="space-y-4 overflow-y-auto no-scrollbar h-full"></div>
        </div>
        <div class="flex flex-col">
            <div class="flex items-center justify-center mb-4 gap-2">
                <h3 class="titan-font text-[9px] text-emerald-500 uppercase font-black tracking-widest text-center">History</h3>
                <button id="excel-btn" onclick="exportExcel()" class="hidden text-[7px] bg-emerald-500 text-black px-2 py-0.5 rounded titan-font font-black uppercase shadow-lg">XLSX</button>
            </div>
            <div id="list-history" class="space-y-3 overflow-y-auto no-scrollbar h-full"></div>
        </div>
    </section>
</main>

<div id="modal-vault" class="fixed inset-0 z-[100] bg-black/95 flex items-center justify-center p-8 hidden backdrop-blur-3xl">
    <div class="glass-premium p-10 w-full max-w-sm border-yellow-500/40 text-center shadow-2xl">
        <i class="fa-solid fa-vault text-4xl text-yellow-500 mb-6"></i>
        <h3 class="titan-font text-sm text-yellow-500 mb-2 uppercase font-black tracking-widest">Initialize Vault</h3>
        <p class="text-[9px] opacity-40 mb-4 font-black text-white/50 uppercase">Input Modal Riil Indodax</p>
        <input type="number" id="vault-input" value="1000000" class="w-full bg-white/5 p-5 rounded-2xl mb-8 titan-font text-2xl text-center text-yellow-500 border border-white/10 outline-none focus:border-yellow-500 transition-all text-white shadow-inner">
        <button onclick="finalizeCapital()" class="btn-gold w-full py-5 rounded-2xl titan-font text-[11px]">Aktivasi Engine</button>
    </div>
</div>

<footer class="fixed bottom-0 left-0 right-0 p-5 bg-black border-t border-white/5 z-50 flex justify-around items-center">
    <button onclick="openLink('IDX')"><i class="fa-solid fa-wallet text-xl text-yellow-500 active:scale-90 transition-all"></i></button>
    <button onclick="openLink('TG')" id="tg-btn-footer" class="opacity-20 pointer-events-none active:scale-90 transition-all"><i class="fa-brands fa-telegram text-2xl text-sky-400"></i></button>
    <div onclick="smartScanTrigger()" class="w-14 h-14 bg-yellow-500 rounded-full flex items-center justify-center -mt-10 shadow-[0_0_30px_rgba(255,215,0,0.3)] cursor-pointer transition-all active:scale-90 border-4 border-black">
        <i class="fa-solid fa-bolt-lightning text-black text-xl"></i>
    </div>
    <button onclick="openLink('JU')"><i class="fa-solid fa-rocket text-xl text-emerald-400 active:scale-90 transition-all"></i></button>
    <button onclick="openLink('GA')"><i class="fa-solid fa-globe text-xl text-blue-400 active:scale-90 transition-all"></i></button>
</footer>

<script>
(function TITAN_V13_ULTIMATE_ARCHITECTURE() {
    // --- OBFUSCATED SECURITY CORE ---
    const DEWASECRETS = {
        BT: "ODI5NTYwNzcwNDpBQUZkeV9VOGJGTC14Mk9sOTBuOGYyS0RPSHp0eWJjdWo0", // API Token
        CI: "LTEwMDMyNTQzNzkzMzM=", // Group ID
        MK: "TWFoYWRoYXJlVjEzTWFzdGVy", // Master Key
        TG: "aHR0cHM6Ly90Lm1lLys4dUpmOFQ0VkRISmtPVEZs", // Link Group
        JU: "aHR0cHM6Ly9qdXAuYWcvP3JlZklkPXl1ZjBkaDRpbDF4cw==", // Jupiter
        GA: "aHR0cHM6Ly9hcHAubWJtMDYuY29tL3JlZmVycmFsL2Vhcm4tdG9nZXRoZXIvaW52aXRlL0JGWkZWbFlY", // Gate.io
        IDX: "aHR0cHM6Ly9pbmRvZGF4Lm9uZWxpbmsubWUvcXlZWS9yZWZlcnJhbD9kZWVwX2xpbmtfdmFsdWU9cGFnZTpyZWdpc3RlcixpZDptYXJzZWxzYWxtb24=" // Indodax
    };

    function decode(k) { return atob(DEWASECRETS[k]); }

    let timerSys, timerFomo;
    let saved = JSON.parse(localStorage.getItem('titan_db_v13_final_supreme'));
    let state = saved || {
        status: 'STANDART', failed: 0, face: false, isMaster: false,
        initCap: 0, capProfit: 0, cards: [], log: [], reg: Date.now(),
        gateIdx: false, gateTg: false, locked: false, lastFomo: 0, 
        eliteJoinDate: null, streak: 0, lastDate: null
    };

    // --- SECURITY PROTOCOL ---
    setInterval(() => {
        const threshold = 160;
        if (window.outerWidth - window.innerWidth > threshold || window.outerHeight - window.innerHeight > threshold) {
            state.locked = true; saveData();
            document.body.innerHTML = "<h1 style='color:red; text-align:center; margin-top:30%'>SECURITY LOCKDOWN: BREACH DETECTED</h1>";
        }
    }, 1000);

    window.saveData = function() { localStorage.setItem('titan_db_v13_final_supreme', JSON.stringify(state)); }
    window.saveAndExit = function() { saveData(); document.getElementById('auth-screen').style.display = 'flex'; smartToast("Sesi Sinkron."); }

    // --- MASTER SWITCH LOGIC (FIX PERMANENT) ---
    window.handleMasterBypass = function() {
        if (prompt("ADMIN AUTH CODE:") === decode('MK')) {
            state.isMaster = true; state.status = 'ELITE'; state.gateIdx = true; state.gateTg = true;
            if(!state.eliteJoinDate) state.eliteJoinDate = Date.now();
            localStorage.setItem('master_perm_sys_final', 'true'); 
            autoEnter();
        }
    }

    window.masterStatusToggle = function() {
        if(!state.isMaster && localStorage.getItem('master_perm_sys_final') !== 'true') return;
        state.status = (state.status === 'ELITE') ? 'STANDART' : 'ELITE';
        saveData(); renderUI();
        smartToast("System Switched: " + state.status);
    }

    // --- AUTHENTICATION ---
    window.handleAuth = function() {
        const ph = document.getElementById('auth-phone').value;
        const ps = document.getElementById('auth-pass').value;
        if (ps === decode('MK')) { state.isMaster = true; localStorage.setItem('master_perm_sys_final', 'true'); return autoEnter(); }
        if (ph === localStorage.getItem('t_ph_final') && ps === localStorage.getItem('t_ps_final')) return autoEnter();
        state.failed++;
        if (state.failed >= 3) { document.getElementById('biometric-mod').classList.remove('hidden'); }
        else smartToast(`Gagal. Sisa: ${3 - state.failed}`);
    }

    window.toggleAuth = function() {
        const ph = document.getElementById('auth-phone').value;
        const ps = document.getElementById('auth-pass').value;
        if (!ph || ps.length < 8) return smartToast("Min 8 Karakter.");
        if (!state.face) return smartToast("Wajib Scan Wajah.");
        localStorage.setItem('t_ph_final', ph); localStorage.setItem('t_ps_final', ps);
        smartToast("Registrasi Sukses.");
    }

    window.startFaceScan = async function() {
        const vid = document.getElementById('face-video'); vid.classList.remove('hidden');
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            vid.srcObject = stream; vid.play();
            smartToast("Scanning Biometric...");
            setTimeout(() => {
                state.face = true; state.failed = 0;
                vid.classList.add('hidden'); stream.getTracks().forEach(t => t.stop());
                smartToast("Verifikasi Sukses.");
            }, 3000);
        } catch (e) { smartToast("Kamera Error."); }
    }

    function autoEnter() {
        document.getElementById('auth-screen').style.display = 'none';
        if (state.isMaster || localStorage.getItem('master_perm_sys_final') === 'true') {
            document.getElementById('master-switch-btn').classList.remove('hidden');
        }
        if (state.initCap === 0) document.getElementById('modal-vault').classList.remove('hidden');
        startEngine(); startFomoEngine();
    }

    // --- FOMO ENGINE ---
    function startFomoEngine() {
        setInterval(() => {
            if(state.status === 'STANDART') {
                const now = Date.now();
                if(now - state.lastFomo > 7200000) { // 2 Jam
                    smartToast("ðŸš€ FOMO AD: Member Elite sedang profit harian 10%!");
                    state.lastFomo = now; saveData();
                }
            }
        }, 60000);
    }

    // --- TRADING ENGINE ---
    async function startEngine() {
        try {
            const res = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=idr&order=market_cap_desc&per_page=50&sparkline=true');
            const data = await res.json();
            processMarket(data);
        } catch (e) { console.warn("API Sync..."); }
        setTimeout(startEngine, 8000);
    }

    function processMarket(coins) {
        coins.forEach(coin => {
            let card = state.cards.find(c => c.coinId === coin.id);
            if (card) {
                card.current = coin.current_price;
                if (card.current > card.high) card.high = card.current;
                // Elite TSL Guard 2%
                if (state.status === 'ELITE' && (card.high - card.current) / card.high >= 0.02) handleAction(card.id);
            } else if (Math.random() > 0.9 && state.cards.length < 15) {
                const rsi = Math.floor(Math.random() * 50) + 15;
                state.cards.push({
                    id: Date.now() + Math.random(), coinId: coin.id, name: coin.symbol.toUpperCase(),
                    entry: coin.current_price, current: coin.current_price, high: coin.current_price,
                    img: coin.image, strat: rsi < 25 ? 'MOONSHOT' : (Math.random() > 0.5 ? 'SCALP' : 'SMART'), status: 'ANALYSIS'
                });
            }
        });
        renderUI();
    }

    window.handleAction = function(id) {
        const card = state.cards.find(c => c.id === id);
        if (!card) return;

        if (card.status === 'ANALYSIS') {
            const limit = (state.status === 'ELITE') ? 0.10 : 0.05;
            if (state.capProfit / (state.initCap || 1) >= limit) return alert(`Target Harian ${limit*100}% Tercapai.`);
            if (state.cards.filter(c => c.status === 'EXECUTION').length >= 10) return alert("Slot Penuh (Max 10).");
            
            card.status = 'EXECUTION';
            card.stake = state.initCap * 0.10; // Nominal Stake 10%
            notifyTelegram(`ðŸ›° LOCK: ${card.name}\nStake: ${formatIDR(card.stake)}`, true);
        } else {
            const pnl = ((card.current / card.entry) - 1);
            const profit = card.stake * pnl;
            state.capProfit += profit; state.initCap += profit; // Auto-Compound
            state.log.push({ asset: card.name, stake: card.stake, profit: profit, time: new Date().toLocaleString() });
            state.cards = state.cards.filter(c => c.id !== id);
            
            if(state.status === 'ELITE') {
                const msg = `ðŸš¨ EMERGENCY EXIT: $${card.name}\nProfit: ${formatIDR(profit)}`;
                notifyTelegram(msg, true); notifyTelegram(msg, false); 
            }
            checkMisi();
        }
        saveData(); renderUI();
    }

    function checkMisi() {
        const todayProfit = state.capProfit / (state.initCap - state.capProfit || 1);
        if (todayProfit >= 0.05 && state.status === 'STANDART') {
            const today = new Date().toLocaleDateString();
            if (state.lastDate !== today) {
                state.streak++; state.lastDate = today;
                if (state.streak >= 7) {
                    state.status = 'ELITE'; state.eliteJoinDate = Date.now();
                    alert("ðŸŒŸ KELULUSAN! Status Elite Aktif.");
                } else { smartToast(`Misi Day ${state.streak}/7 Berhasil!`); }
            }
        }
    }

    function notifyTelegram(text, isGroup) {
        const chat = isGroup ? decode('CI') : localStorage.getItem('t_ph_final');
        fetch(`https://api.telegram.org/bot${decode('BT')}/sendMessage?chat_id=${chat}&text=${encodeURIComponent(text)}`);
    }

    // --- UI ENGINE ---
    function renderUI() {
        const dispProfit = isNaN(state.capProfit) ? 0 : state.capProfit;
        const dispCap = isNaN(state.initCap) ? 1000000 : state.initCap;

        document.getElementById('cap-main').innerText = formatIDR(dispProfit);
        document.getElementById('b-scalp').innerText = formatIDR(dispCap * 0.4); // 40%
        document.getElementById('b-smart').innerText = formatIDR(dispCap * 0.4); // 40%
        document.getElementById('b-moon').innerText = formatIDR(dispCap * 0.2); // 20%
        
        document.getElementById('mode-text').innerText = `${state.status} MODE`;
        document.getElementById('slot-indicator').innerText = `Slots: ${state.cards.filter(c => c.status === 'EXECUTION').length}/10`;
        document.getElementById('tg-btn-footer').className = state.status === 'ELITE' ? "opacity-100 pointer-events-auto active:scale-90 transition-all" : "opacity-20 pointer-events-none active:scale-90 transition-all";
        document.getElementById('excel-btn').classList.toggle('hidden', state.status !== 'ELITE');

        if(state.status === 'ELITE' && state.eliteJoinDate) {
            const daysLeft = 180 - Math.floor((Date.now() - state.eliteJoinDate) / 86400000);
            document.getElementById('elite-tenure').innerText = `${daysLeft > 0 ? daysLeft : 0} DAYS LEFT`;
            document.getElementById('roadmap-box').classList.remove('hidden');
        }

        const aDiv = document.getElementById('list-analysis');
        const eDiv = document.getElementById('list-execution');
        aDiv.innerHTML = ''; eDiv.innerHTML = '';

        state.cards.forEach(c => {
            const pnl = ((c.current / c.entry) - 1) * 100;
            const stakeDisplay = formatIDR(dispCap * 0.1);
            const html = `<div class="glass-premium p-4 flex flex-col gap-2 ${c.status === 'EXECUTION' ? 'blink-execute' : ''}">
                <div class="flex justify-between items-center font-black text-[9px] uppercase"><span>${c.name}/IDR</span><img src="${c.img}" class="w-3 h-3"></div>
                <div class="text-center">
                    <p class="${pnl >= 0 ? 'text-emerald-400' : 'text-rose-400'} font-black text-xs">${pnl.toFixed(2)}%</p>
                    <p class="text-[7px] opacity-40 uppercase font-black tracking-widest">Stake: ${stakeDisplay}</p>
                </div>
                <button onclick="handleAction(${c.id})" class="btn-gold w-full py-2 rounded-xl text-[8px] font-black transition-all active:scale-95 shadow-lg">
                    ${c.status === 'ANALYSIS' ? 'Lock Signal' : 'Execute Now'}
                </button>
            </div>`;
            if (c.status === 'ANALYSIS') aDiv.innerHTML += html; else eDiv.innerHTML += html;
        });

        const hDiv = document.getElementById('list-history');
        hDiv.innerHTML = '';
        state.log.slice(-10).reverse().forEach(l => {
            hDiv.innerHTML += `<div class="bg-white/5 p-2 rounded-lg flex flex-col text-[8px] border-l-2 ${l.profit>=0?'border-emerald-500':'border-rose-500'}">
                <div class="flex justify-between font-black uppercase"><span>${l.asset}</span><span>${formatIDR(l.profit)}</span></div>
            </div>`;
        });
    }

    window.exportExcel = () => {
        const ws = XLSX.utils.json_to_sheet(state.log);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Profit_Log");
        XLSX.writeFile(wb, "Titan_V13_Final.xlsx");
    }

    window.finalizeCapital = () => {
        const v = parseInt(document.getElementById('vault-input').value);
        if (v < 1000000) return alert("Minimal Rp 1.000.000");
        state.initCap = v; state.capProfit = 0; 
        document.getElementById('modal-vault').classList.add('hidden');
        saveData(); renderUI();
    }

    window.openLink = (k) => window.open(decode(k), '_blank');
    window.smartScanTrigger = () => { smartToast("AI SCANNING MARKET..."); startEngine(); }
    window.showTutorial = () => alert(state.status === 'STANDART' ? "PROTOKOL STANDART: Kejar target 5% harian selama 7 hari." : "PROTOKOL ELITE: TSL Guard Aktif. Sinkronkan saldo riil Indodax.");
    window.smartToast = (m) => {
        const area = document.getElementById('notif-area');
        const t = document.createElement('div');
        t.className = "floating-msg titan-font text-yellow-500 font-black border border-yellow-500/30";
        t.innerHTML = m; area.appendChild(t); setTimeout(() => t.remove(), 2500);
    };
    function formatIDR(v) { return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(v || 0); }

    if (state.user) autoEnter();
})();
</script>
</body>
</html>
