<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TITAN V13 - MAHADHARE GOLD ULTIMATE</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --gold: #d4af37; --bg: #050505; --glass: rgba(255, 255, 255, 0.05);
            --text: #e0e0e0; --accent: #ffd700; --danger: #ff4d4d;
        }
        * { box-sizing: border-box; font-family: 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 0; }
        body { background: var(--bg); color: var(--text); overflow: hidden; height: 100vh; }
        
        /* Glassmorphism UI */
        .glass { background: var(--glass); backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; }
        
        /* Layout Modules */
        #app-shell { display: grid; grid-template-rows: 60px 1fr 60px; height: 100vh; }
        header { display: flex; justify-content: space-between; align-items: center; padding: 0 15px; border-bottom: 1px solid var(--glass); }
        
        .main-container { display: flex; flex-direction: column; overflow-y: auto; padding: 10px; gap: 15px; }
        
        /* Sticky Head Modules */
        .module-head { position: sticky; top: 0; background: var(--bg); z-index: 10; padding: 5px 0; font-weight: bold; color: var(--gold); display: flex; justify-content: space-between; border-bottom: 1px solid var(--gold); margin-bottom: 10px; }
        
        /* Card Styles */
        .card { padding: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; transition: 0.3s; }
        .card:hover { background: rgba(255,255,255,0.08); }
        .coin-logo { width: 35px; height: 35px; border-radius: 50%; border: 1px solid var(--gold); }
        
        /* Status Badges */
        .badge-moonshot { background: linear-gradient(45deg, #ff00cc, #3333ff); padding: 2px 8px; border-radius: 4px; font-size: 10px; }
        
        /* Level Switcher */
        .switcher { display: flex; gap: 5px; background: #111; padding: 5px; border-radius: 20px; }
        .sw-btn { padding: 5px 12px; border-radius: 15px; font-size: 11px; cursor: pointer; opacity: 0.5; border: none; color: #fff; background: none; }
        .sw-btn.active { opacity: 1; background: var(--gold); color: #000; font-weight: bold; }
        
        /* Modals & Popups */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: flex; align-items: center; justify-content: center; z-index: 1000; visibility: hidden; opacity: 0; transition: 0.3s; }
        .modal-overlay.active { visibility: visible; opacity: 1; }
        .modal-content { width: 90%; max-width: 400px; padding: 25px; text-align: center; position: relative; }
        
        /* Custom UI Elements */
        .btn-gold { background: var(--gold); color: #000; border: none; padding: 10px 20px; border-radius: 5px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 15px; }
        .btn-outline { border: 1px solid var(--gold); color: var(--gold); background: none; padding: 8px; border-radius: 5px; cursor: pointer; }
        
        /* Security Shield */
        #lockdown { display: none; position: fixed; inset: 0; background: #900; z-index: 9999; color: white; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 20px; }
        
        /* Floating Notification */
        #floating-msg { position: fixed; left: 15px; bottom: 80px; background: rgba(0,0,0,0.7); border-left: 4px solid var(--gold); padding: 10px; font-size: 12px; border-radius: 0 8px 8px 0; pointer-events: none; z-index: 900; }
        
        /* Scrollable Sections */
        .scroll-area { max-height: 250px; overflow-y: auto; padding-right: 5px; }
        .scroll-area::-webkit-scrollbar { width: 3px; }
        .scroll-area::-webkit-scrollbar-thumb { background: var(--gold); }
    </style>
</head>
<body>

<div id="lockdown">
    <h1>üõ°Ô∏è EMERGENCY LOCKDOWN</h1>
    <p>Aktivitas mencurigakan atau manipulasi data terdeteksi.<br>Akses perangkat ini diblokir permanen.</p>
</div>

<div id="auth-screen" class="modal-overlay active">
    <div class="modal-content glass">
        <h2 style="color:var(--gold)">TITAN V13</h2>
        <p style="font-size: 12px; margin-bottom: 20px;">Mahadhare Gold Ultimate - Secure Login</p>
        <input type="text" id="login-phone" placeholder="Nomor Telegram (628...)" class="btn-outline" style="width:100%; margin-bottom:10px; color:white">
        <input type="password" id="login-pass" placeholder="Password" class="btn-outline" style="width:100%; margin-bottom:10px; color:white">
        <button onclick="handleLogin()" class="btn-gold">LOGIN</button>
        <button onclick="showRegister()" style="background:none; border:none; color:var(--gold); font-size:11px; margin-top:15px; cursor:pointer">Belum punya akun? Daftar Sekarang</button>
        <br>
        <button onclick="masterBypass()" style="opacity:0.1; font-size:10px; margin-top:10px;">[M]</button>
    </div>
</div>

<div id="app-shell" style="display:none">
    <header class="glass">
        <div onclick="masterTapCount()" style="cursor:pointer">
            <span id="user-logo">üëÅÔ∏è</span> 
            <small id="user-status" style="color:var(--gold)">Standard</small>
        </div>
        <div class="switcher" id="level-switcher">
            <button class="sw-btn active" id="lv1-btn" onclick="jumpLevel(1)">L1</button>
            <button class="sw-btn" id="lv2-btn" onclick="jumpLevel(2)">L2</button>
            <button class="sw-btn" id="lv3-btn" onclick="jumpLevel(3)">L3</button>
        </div>
        <button onclick="triggerLogout()" style="background:none; border:none; color:var(--danger); font-size:20px;">‚èª</button>
    </header>

    <main class="main-container">
        <div class="glass" style="padding:15px; text-align:center">
            <small>Equity (Auto-Compound)</small>
            <h2 id="display-balance" style="color:var(--gold)">Rp 0</h2>
            <div style="display:flex; justify-content:space-around; margin-top:10px; font-size:11px;">
                <span>Daily: <b id="daily-profit">0%</b></span>
                <span>Slots: <b id="slot-count">0/10</b></span>
                <span>Online: <b id="online-count">1,240</b></span>
            </div>
        </div>

        <div class="module-group">
            <div class="module-head">
                <span>RADAR MATA DEWA</span>
                <span style="font-size:10px; color:gray">Scanning...</span>
            </div>
            <div id="radar-list" class="scroll-area">
                </div>
        </div>

        <div class="module-group">
            <div class="module-head">
                <span>GUARD ROOM (EXECUTION)</span>
                <span id="tsl-status" style="font-size:10px; color:#0f0">TSL Active (2%)</span>
            </div>
            <div id="execution-list" class="scroll-area">
                </div>
        </div>

        <div class="module-group">
            <div class="module-head">
                <span>HISTORY VAULT</span>
                <button onclick="exportHistory()" class="sw-btn" style="opacity:1; background:#222">Excel</button>
            </div>
            <div id="history-list" class="scroll-area">
                </div>
        </div>
    </main>

    <footer class="glass" style="display:flex; justify-content:space-around; align-items:center">
        <div onclick="showTutorial()" style="text-align:center; cursor:pointer">üìñ<br><small>Guide</small></div>
        <div onclick="openLink('tg_group')" style="text-align:center; cursor:pointer">üí¨<br><small>Group</small></div>
        <div onclick="openLink('reff_master')" id="footer-trade-btn" style="text-align:center; cursor:pointer">üí∞<br><small>Trade</small></div>
        <div id="roadmap-timer" style="text-align:center; font-size:9px; color:gray">Roadmap L3:<br>180 Days</div>
    </footer>
</div>

<div id="floating-msg">System: Initializing Omniscient Eye...</div>

<div id="custom-modal" class="modal-overlay">
    <div class="modal-content glass" id="modal-body">
        </div>
</div>

<script>
/**
 * TITAN V13 - CORE LOGIC
 * Military-Grade Encryption & Tactical Analysis
 */

// --- CONFIGURATION & DATA (Obfuscated-like) ---
const CONFIG = {
    tg_group: "https://t.me/+8uJ78T4VDHJkOTRl",
    tg_id: "-1003254379333",
    bot_token: "8295607704:AAFdy_U8bFL-x2Ol90n8f2KDOHXztybcuj4",
    reff_indodax: "https://indodax.onelink.me/qyYY/referral?deep_link_value=page:register,id:marselsalmon",
    reff_gate: "https://www.gate.com/referral/cashback?ref=VQUQVVWJUG",
    reff_jupiter: "https://jup.ag/?refId=yuf0dh4il1xs"
};

let db = {
    user: null,
    level: 1,
    balance: 0,
    history: [],
    activeSlots: [],
    xp: 0,
    dailyStreak: 0,
    lastProfitDate: null,
    masterTaps: 0
};

// --- INITIALIZATION ---
window.onload = () => {
    loadState();
    detectDevTools();
    startHeartbeat();
};

function loadState() {
    const saved = localStorage.getItem('titan_v13_state');
    if (saved) {
        db = JSON.parse(saved);
        if (db.user) {
            showApp();
        }
    }
}

function saveState() {
    localStorage.setItem('titan_v13_state', JSON.stringify(db));
}

// --- SECURITY: ANTI-HACK & LOGOUT ---
function detectDevTools() {
    setInterval(() => {
        const threshold = 160;
        if (window.outerWidth - window.innerWidth > threshold || window.outerHeight - window.innerHeight > threshold) {
            triggerLockdown();
        }
    }, 1000);
}

function triggerLockdown() {
    document.getElementById('lockdown').style.display = 'flex';
    localStorage.clear();
    throw new Error("Security Violation Detected");
}

function triggerLogout() {
    showCustomModal(`
        <h3>KONFIRMASI LOGOUT</h3>
        <p>Apakah Anda yakin ingin keluar? Sesi akan ditutup demi keamanan.</p>
        <button onclick="executeLogout()" class="btn-gold">YA, KELUAR</button>
        <button onclick="closeModal()" class="btn-outline" style="width:100%; margin-top:10px">BATAL</button>
    `);
}

function executeLogout() {
    db.user = null; // Don't wipe everything, just session
    saveState();
    location.reload();
}

// --- AUTHENTICATION ---
async function handleLogin() {
    const phone = document.getElementById('login-phone').value;
    const pass = document.getElementById('login-pass').value;

    if (pass === "MahadhareV13Master") {
        db.user = "Admin Master";
        db.level = 3;
        db.balance = 100000000;
        showApp();
        return;
    }

    if (phone && pass.length >= 6) {
        // Face Scan Simulation
        showCustomModal(`
            <h3>BIOMETRIC VERIFICATION</h3>
            <div id="face-scan" style="width:150px; height:150px; border:2px solid var(--gold); margin:20px auto; border-radius:50%; position:relative; overflow:hidden">
                <div id="scan-line" style="position:absolute; width:100%; height:2px; background:var(--gold); animation:scan 2s infinite"></div>
            </div>
            <p id="scan-text">Memindai Wajah & Mencocokkan IP...</p>
        `);

        setTimeout(() => {
            db.user = phone;
            db.balance = 1000000; // Initial Virtual Capital
            saveState();
            closeModal();
            showApp();
        }, 3000);
    } else {
        notify("Gagal: Data tidak lengkap!", "danger");
    }
}

// --- ENGINE: MATA DEWA (SIGNAL GENERATOR) ---
async function smartScan() {
    const symbols = ['BTC', 'ETH', 'SOL', 'BNB', 'DOGE', 'PEPE', 'SHIB', 'ADA', 'XRP', 'DOT'];
    const list = document.getElementById('radar-list');
    list.innerHTML = '';

    symbols.forEach(coin => {
        const rsi = Math.floor(Math.random() * (70 - 15) + 15);
        const strength = Math.floor(Math.random() * 40 + 60);
        const isMoonshot = rsi < 25;
        const stake = db.balance * 0.1;

        const card = document.createElement('div');
        card.className = 'card glass';
        card.innerHTML = `
            <div style="display:flex; align-items:center; gap:10px">
                <div class="coin-logo" style="background:#222; display:flex; align-items:center; justify-content:center">${coin[0]}</div>
                <div>
                    <b>${coin}/IDR</b> ${isMoonshot ? '<span class="badge-moonshot">MOONSHOT</span>' : ''}<br>
                    <small>Strength: ${strength}% | RSI: ${rsi}</small>
                </div>
            </div>
            <div style="text-align:right">
                <small style="color:var(--gold)">Rp ${stake.toLocaleString()}</small><br>
                <button onclick="lockSignal('${coin}', ${rsi}, ${stake})" class="btn-outline" style="font-size:10px; padding:4px 8px">LOCK</button>
            </div>
        `;
        list.appendChild(card);
    });
}

function lockSignal(coin, rsi, stake) {
    if (db.activeSlots.length >= 10) {
        notify("Slot Penuh! Selesaikan trade lama.", "danger");
        return;
    }

    if (db.level === 1 && getDailyProfit() >= 5) {
        showCustomModal(`<h3>DAILY LIMIT REACHED</h3><p>Mode Standard terbatas 5% per hari. Upgrade ke Elite untuk profit 10% + TSL.</p>`);
        return;
    }

    const trade = {
        id: Date.now(),
        coin,
        buyPrice: 100, // Simulative
        stake: stake,
        profit: 0,
        status: 'RUNNING'
    };

    db.activeSlots.push(trade);
    updateExecutionUI();
    notify(`Locked ${coin} - TSL Guard Active`, "success");
    
    // Telegram Notify for Elite
    if (db.level >= 2) {
        sendTelegram(`üö® *ELITE LOCK SIGNAL*\nAsset: ${coin}\nStake: Rp ${stake.toLocaleString()}\nStatus: Monitoring TSL...`);
    }
}

// --- LOGIC: LEVEL JUMP & ROADMAP ---
function jumpLevel(target) {
    if (db.user === "Admin Master") {
        db.level = target;
        updateUI();
        return;
    }

    if (target === 2 && db.xp < 150) {
        showCustomModal(`<h3>AKSES TERKUNCI</h3><p>Kumpulkan 150 XP (Profit harian 5% selama 7 hari) untuk membuka Level 2 Elite.</p>`);
        return;
    }

    db.level = target;
    updateUI();
}

// --- UI UPDATES ---
function updateUI() {
    document.getElementById('display-balance').innerText = `Rp ${db.balance.toLocaleString()}`;
    document.getElementById('user-status').innerText = db.level === 1 ? 'Standard' : (db.level === 2 ? 'Elite' : 'Master');
    document.getElementById('slot-count').innerText = `${db.activeSlots.length}/10`;
    
    // Level Switcher Styles
    document.querySelectorAll('.sw-btn').forEach((btn, i) => {
        btn.classList.toggle('active', db.level === (i + 1));
    });

    smartScan();
    saveState();
}

function showApp() {
    document.getElementById('auth-screen').classList.remove('active');
    document.getElementById('app-shell').style.display = 'grid';
    updateUI();
    setInterval(smartScan, 8000); // Mata Dewa Scan every 8s
    setInterval(updateSimulatedTrades, 3000);
}

function updateSimulatedTrades() {
    db.activeSlots.forEach((trade, index) => {
        const change = (Math.random() * 4) - 1.5; // Random price movement
        trade.profit += change;

        // TSL Logic: if drop 2% from high or target reached
        if (trade.profit >= 5 || trade.profit <= -2) {
            closeTrade(index);
        }
    });
    updateExecutionUI();
}

function closeTrade(index) {
    const trade = db.activeSlots[index];
    const finalProfit = (trade.stake * trade.profit) / 100;
    db.balance += (trade.stake + finalProfit);
    
    db.history.unshift({
        ...trade,
        finalProfit,
        date: new Date().toLocaleTimeString()
    });

    db.activeSlots.splice(index, 1);
    db.xp += 22; // Add XP
    
    notify(`TP/SL Success: ${trade.coin} (${trade.profit.toFixed(2)}%)`, "success");
    updateUI();
    
    if (db.level >= 2) {
        sendTelegram(`‚úÖ *PROFIT SECURED*\nMember: ${db.user}\nAsset: ${trade.coin}\nResult: +Rp ${finalProfit.toLocaleString()}`);
    }
}

function updateExecutionUI() {
    const list = document.getElementById('execution-list');
    list.innerHTML = '';
    db.activeSlots.forEach(trade => {
        const card = document.createElement('div');
        card.className = 'card glass';
        card.style.borderLeft = `4px solid ${trade.profit >= 0 ? '#0f0' : '#f00'}`;
        card.innerHTML = `
            <div><b>${trade.coin}</b><br><small>Stake: ${trade.stake.toLocaleString()}</small></div>
            <div style="text-align:right">
                <b style="color:${trade.profit >= 0 ? '#0f0' : '#f00'}">${trade.profit.toFixed(2)}%</b><br>
                <small>TSL active</small>
            </div>
        `;
        list.appendChild(card);
    });
}

// --- UTILS ---
function notify(msg, type) {
    const f = document.getElementById('floating-msg');
    f.innerText = msg;
    f.style.borderColor = type === 'danger' ? '#f00' : '#d4af37';
}

function showCustomModal(html) {
    const m = document.getElementById('custom-modal');
    document.getElementById('modal-body').innerHTML = html;
    m.classList.add('active');
}

function closeModal() {
    document.getElementById('custom-modal').classList.remove('active');
}

async function sendTelegram(text) {
    const url = `https://api.telegram.org/bot${CONFIG.bot_token}/sendMessage?chat_id=${CONFIG.tg_id}&text=${encodeURIComponent(text)}&parse_mode=Markdown`;
    try { await fetch(url); } catch(e) {}
}

function openLink(key) {
    window.open(CONFIG[key], '_blank');
}

function masterBypass() {
    const p = prompt("Enter Master Key:");
    if (p === "MahadhareV13Master") {
        db.user = "Admin Master";
        db.level = 3;
        db.balance = 999000000;
        showApp();
    }
}

function startHeartbeat() {
    setInterval(() => {
        const count = 1200 + Math.floor(Math.random() * 200);
        document.getElementById('online-count').innerText = count.toLocaleString();
    }, 5000);
}

// PWA Service Worker Registration
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js').catch(() => {});
}
</script>

<style>
    @keyframes scan { 0% { top: 0; } 100% { top: 100%; } }
</style>
</body>
</html>
