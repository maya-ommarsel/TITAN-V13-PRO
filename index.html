<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <link rel="manifest" href="manifest.json">
    <title>TITAN V13 - MAHADHARE GOLD ULTIMATE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Space+Grotesk:wght@300;500;700&display=swap');
        :root { --gold: #ffd700; --emerald: #10b981; --glass: rgba(10, 10, 20, 0.98); }
        body { background: #010205; color: #e2e8f0; font-family: 'Space Grotesk', sans-serif; overflow: hidden; height: 100vh; user-select: none; }
        .titan-font { font-family: 'Orbitron', sans-serif; }
        .glass-premium { background: var(--glass); backdrop-filter: blur(30px); border: 1px solid rgba(255, 215, 0, 0.1); border-radius: 1.5rem; }
        .btn-gold { background: linear-gradient(135deg, #ffd700 0%, #b8860b 100%); color: black; font-weight: 900; transition: 0.3s; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* Layout Sticky & Columns */
        .head-sticky { position: sticky; top: 0; background: #010205; z-index: 50; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .module-scroll { height: calc(100vh - 610px); overflow-y: auto; scroll-behavior: smooth; }

        /* Level Switcher */
        .switch-btn { padding: 10px 18px; border-radius: 12px; font-size: 8px; font-family: 'Orbitron'; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.02); cursor: pointer; color: white; }
        .switch-active { background: var(--gold) !important; color: black !important; border-color: var(--gold); box-shadow: 0 0 20px rgba(255,215,0,0.4); font-weight: 900; }
        .switch-locked { opacity: 0.15; filter: grayscale(1); cursor: not-allowed; }

        /* Notifikasi Sebelah Kiri - Anti Obstruction */
        #notif-area { position: fixed; bottom: 100px; left: 20px; z-index: 90000; display: flex; flex-direction: column; gap: 8px; pointer-events: none; }
        .notif-toast { animation: slideInLeft 0.5s ease-out forwards; pointer-events: auto; }
        @keyframes slideInLeft { from { transform: translateX(-100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* FIX MODAL LOGOUT - Z-INDEX TERTINGGI */
        #modal-overlay { position: fixed; inset: 0; z-index: 200000; background: rgba(0,0,0,0.96); backdrop-filter: blur(25px); display: none; align-items: center; justify-content: center; padding: 24px; }
        #modal-box { transform: scale(0.85); opacity: 0; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .modal-active #modal-overlay { display: flex; }
        .modal-active #modal-box { transform: scale(1); opacity: 1; }
        
        #webcam { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); border-radius: 1rem; }
        .scan-line { position: absolute; top: 0; width: 100%; height: 2px; background: var(--emerald); box-shadow: 0 0 10px var(--emerald); animation: scan 2s linear infinite; }
        @keyframes scan { 0% { top: 0%; } 100% { top: 100%; } }

        .locked-wallet { position: relative; cursor: not-allowed; }
        .locked-wallet::after { content: "\f023"; font-family: "Font Awesome 6 Free"; font-weight: 900; position: absolute; top: -5px; right: -5px; color: var(--gold); font-size: 10px; }
    </style>
</head>
<body class="no-scrollbar">

    <div id="master-trigger" onclick="handleLogoTap()" class="fixed top-0 left-0 w-20 h-20 z-[1000000] cursor-pointer"></div>

    <div id="modal-overlay">
        <div id="modal-box" class="glass-premium p-8 w-full max-w-sm border-yellow-500/20 shadow-2xl text-center">
            <div id="modal-icon" class="mb-4 text-5xl text-yellow-500"></div>
            <h3 id="modal-title" class="titan-font text-yellow-500 mb-2 uppercase text-[10px] tracking-widest"></h3>
            <div id="modal-body" class="text-[10px] text-white/60 mb-8 leading-relaxed text-left"></div>
            <div id="modal-actions" class="flex flex-col gap-2"></div>
        </div>
    </div>

    <div id="notif-area"></div>

    <div id="auth-gate" class="fixed inset-0 z-[50000] bg-[#010205] flex flex-col items-center p-8 overflow-y-auto">
        <div class="mt-12 mb-10 flex flex-col items-center">
            <div id="biometric-box" class="w-32 h-32 glass-premium border-yellow-500/30 flex items-center justify-center relative overflow-hidden mb-4 shadow-[0_0_30px_rgba(255,215,0,0.1)]">
                <i id="logo-main" class="fa-solid fa-eye text-6xl text-yellow-500"></i>
                <div id="webcam-box" class="absolute inset-0 hidden"><video id="webcam" autoplay muted playsinline></video><div class="scan-line"></div></div>
            </div>
            <h1 class="titan-font text-2xl text-yellow-500 tracking-[0.3em]">TITAN V.13</h1>
            <p class="text-[8px] opacity-40 uppercase font-black text-white">Mahadhare Gold Ultimate</p>
        </div>
        <div class="w-full max-w-sm space-y-4">
            <input type="tel" id="user-chatid" placeholder="TELEGRAM CHAT ID" class="w-full bg-white/5 p-4 rounded-xl border border-white/10 text-white text-center outline-none focus:border-gold titan-font text-sm uppercase">
            <input type="password" id="user-pwd" placeholder="SECURITY PASSWORD" class="w-full bg-white/5 p-4 rounded-xl border border-white/10 text-white text-center outline-none font-black tracking-widest focus:border-gold">
            <p id="liveness-hint" class="text-[8px] text-emerald-400 text-center uppercase hidden font-black animate-pulse">Sistem: Scan Wajah Sedang Berjalan</p>
            <button onclick="executeAuth()" class="btn-gold w-full py-4 titan-font rounded-2xl shadow-xl active:scale-95 transition-all">AUTHENTICATE SYSTEM</button>
            <div class="flex justify-between items-center px-2">
                <button onclick="window.open('https://t.me/userinfobot')" class="text-[8px] text-blue-400 font-bold uppercase underline">Cek ID Telegram</button>
                <span id="auth-toggle" onclick="toggleAuthMode()" class="text-[8px] text-white/30 uppercase cursor-pointer">Login / Daftar</span>
            </div>
        </div>
    </div>

    <div id="app-ui" class="hidden h-full flex flex-col">
        <header class="p-5 flex justify-between items-center bg-black/40 border-b border-white/5 relative z-[120000]">
            <div class="flex items-center gap-3">
                <i class="fa-solid fa-crown text-gold text-xl"></i>
                <div>
                    <p id="label-lvl" class="text-[9px] text-gold font-bold uppercase tracking-widest"></p>
                    <div class="flex items-center gap-2">
                        <div class="w-1.5 h-1.5 bg-emerald-500 rounded-full animate-pulse"></div>
                        <p id="online-counter" class="text-[7px] text-emerald-500 font-black titan-font uppercase"></p>
                    </div>
                </div>
            </div>
            <div class="flex gap-4 items-center">
                <div id="api-badge" class="flex items-center gap-1 px-2 py-1 bg-emerald-500/10 rounded-full border border-emerald-500/20">
                    <span class="text-[6px] titan-font text-emerald-500 uppercase">API SYNC</span>
                </div>
                <i onclick="showManual()" class="fa-solid fa-book-open text-gold text-lg cursor-pointer"></i>
                <i onclick="askLogout()" class="fa-solid fa-power-off text-rose-500 text-lg cursor-pointer active:scale-90"></i>
            </div>
        </header>

        <main class="flex-1 overflow-y-auto p-4 pb-32 no-scrollbar">
            <section class="mb-6">
                <div class="glass-premium p-4 border-blue-500/20">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-[8px] titan-font text-blue-400 uppercase font-bold tracking-widest"><i class="fa-solid fa-ranking-star mr-2"></i>Global Level Board</h3>
                    </div>
                    <div id="leader-list-head" class="grid grid-cols-3 gap-2"></div>
                </div>
            </section>

            <section class="glass-premium p-6 text-center mb-6 relative">
                <div class="flex justify-between items-center mb-2">
                    <p class="text-[8px] opacity-40 uppercase tracking-[0.2em]">Equity Compounding</p>
                    <span id="xp-val" class="text-[7px] text-blue-400 font-black uppercase tracking-widest font-bold">XP: 0/150</span>
                </div>
                <h2 id="display-balance" class="titan-font text-4xl text-gold font-black mb-6 tracking-tighter">Rp 0</h2>
                
                <div id="lvl-switcher" class="flex justify-center gap-2 mb-6 border-t border-white/5 pt-5">
                    <button id="sw-1" onclick="jumpLevel(1)" class="switch-btn">Standard</button>
                    <button id="sw-2" onclick="jumpLevel(2)" class="switch-btn">Elite</button>
                    <button id="sw-3" onclick="jumpLevel(3)" class="switch-btn">Master</button>
                </div>

                <div class="grid grid-cols-3 gap-2">
                    <div class="bg-white/5 p-2 rounded-xl border border-white/5"><p class="text-[6px] opacity-40 uppercase mb-1 font-bold">Scalp (40%)</p><p id="cap-scalp" class="text-[9px] font-bold text-white">Rp 0</p></div>
                    <div class="bg-white/5 p-2 rounded-xl border border-white/5"><p class="text-[6px] opacity-40 uppercase mb-1 font-bold">Smart (40%)</p><p id="cap-smart" class="text-[9px] font-bold text-white">Rp 0</p></div>
                    <div class="bg-white/5 p-2 rounded-xl border border-white/5"><p class="text-[6px] opacity-40 uppercase mb-1 font-bold">Moon (20%)</p><p id="cap-moon" class="text-[9px] font-bold text-white">Rp 0</p></div>
                </div>

                <div id="api-panel" class="mt-4 p-4 bg-emerald-500/5 border border-emerald-500/20 rounded-2xl hidden text-left">
                    <div class="flex justify-between mb-3"><span class="text-[8px] text-emerald-500 titan-font uppercase font-bold">Master Node Sync</span><span class="text-[7px] opacity-50 uppercase font-black tracking-widest">Global</span></div>
                    <input type="password" id="api-key" placeholder="API KEY INDODAX" class="w-full bg-black/40 p-3 rounded-xl border border-white/10 text-[9px] text-white mb-2 outline-none">
                    <input type="password" id="api-secret" placeholder="SECRET KEY" class="w-full bg-black/40 p-3 rounded-xl border border-white/10 text-[9px] text-white mb-3 outline-none">
                    <button onclick="syncRealBalance()" class="w-full py-2.5 bg-emerald-500 text-black titan-font text-[8px] rounded-xl font-black uppercase shadow-lg">Activate Node</button>
                </div>
            </section>

            <div class="grid grid-cols-3 gap-4 head-sticky">
                <div class="text-center"><h3 class="titan-font text-[9px] text-emerald-400 uppercase font-black">Radar Dewa</h3></div>
                <div class="text-center border-x border-white/5"><h3 class="titan-font text-[9px] text-blue-400 uppercase font-black">Execution <span id="slot-count" class="text-[7px] text-white/40">0/10</span></h3></div>
                <div class="text-center"><h3 class="titan-font text-[9px] text-gold uppercase font-black">History</h3></div>
            </div>

            <div class="grid grid-cols-3 gap-4">
                <div id="radar-list" class="module-scroll space-y-4 pr-1"></div>
                <div id="execution-list" class="module-scroll space-y-4 border-x border-white/5 px-2"></div>
                <div id="history-list" class="module-scroll space-y-2 opacity-50"></div>
            </div>

            <footer class="mt-10 p-8 text-[7px] opacity-30 text-center space-y-4 border-t border-white/5 bg-black/20 rounded-t-3xl font-bold uppercase tracking-widest">
                <p class="titan-font text-gold font-black">Copyright Â© 2026 Mahadhare Gold Ultimate. All Rights Reserved.</p>
                <p class="italic">Investasi kripto berisiko tinggi. TITAN V13 adalah instrumen bantu analisis AI.</p>
            </footer>
        </main>

        <nav class="fixed bottom-0 w-full bg-black/90 backdrop-blur-xl p-5 flex justify-around items-center border-t border-white/5 z-50">
            <button id="nav-wallet" onclick="handleWalletClick()">
                <div id="wallet-icon-box" class="relative text-xl text-gold">
                    <i class="fa-solid fa-wallet"></i>
                </div>
            </button>
            <button onclick="window.open('https://t.me/+8uJ78T4VDHJkOTRl', '_blank')"><i class="fa-solid fa-paper-plane text-xl text-sky-400"></i></button>
            <div onclick="smartScan()" class="w-14 h-14 bg-gold rounded-full flex items-center justify-center -mt-10 shadow-[0_0_30px_rgba(255,215,0,0.4)] cursor-pointer active:scale-90 transition-transform">
                <i class="fa-solid fa-bolt text-black text-xl"></i>
            </div>
            <button onclick="window.open('https://jup.ag/?refId=yuf0dh4il1xs', '_blank')"><i class="fa-solid fa-rocket text-xl text-emerald-400"></i></button>
            <button onclick="window.open('https://www.gate.com/referral/cashback?ref=VQUQVVWJUG&ref_type=103&page=earnVoucher&utm_cmp=PEYEQdSb', '_blank')"><i class="fa-solid fa-globe text-xl text-blue-400"></i></button>
        </nav>
    </div>

    <script>
        (function TITAN_SUPREME_V13() {
            const _SEC = {
                B: "ODI5NTYwNzcwNDpBQUZkeV9VOGJGTC14Mk9sOTBuOGYyS0RPSHp0eWJjdWo0",
                G: "LTEwMDMyNTQzNzkzMzM=",
                ID_M: "MTMxOTcwMDg2Ng==",
                PW_M: "TWFoYWRoYXJlVjEzTWFzdGVy",
                IDX: "aHR0cHM6Ly9pbmRvZGF4Lm9uZWxpbmsubWUvcXlZWS9yZWZlcnJhbD9kZWVwX2xpbmtfdmFsdWU9cGFnZTpyZWdpc3RlcixpZDptYXJzZWxzYWxtb24="
            };

            let db = JSON.parse(localStorage.getItem('TITAN_V13_ST')) || {
                user: null, lvl: 1, xp: 0, cap: 1000000, m: false, e: false, a: false,
                trades: [], hist: [], ip: null, lastActivity: Date.now()
            };

            let isReg = true, taps = 0, tapTimer, logoutTimer;
            const save = () => { localStorage.setItem('TITAN_V13_ST', JSON.stringify(db)); };

            // FIX: UI POPUP MODAL SYSTEM (PATEN)
            window.popup = (title, body, actions = null, icon = "fa-circle-info") => {
                document.getElementById('modal-icon').innerHTML = `<i class="fa-solid ${icon}"></i>`;
                document.getElementById('modal-title').innerText = title;
                document.getElementById('modal-body').innerHTML = body;
                document.getElementById('modal-actions').innerHTML = actions || '<button onclick="closePop()" class="btn-gold py-3 rounded-xl text-[10px] titan-font uppercase font-bold w-full">Confirm</button>';
                document.body.classList.add('modal-active');
            };
            window.closePop = () => { document.body.classList.remove('modal-active'); };

            window.notif = (msg, type = "gold") => {
                const area = document.getElementById('notif-area');
                const t = document.createElement('div');
                t.className = "notif-toast glass-premium p-3 px-6 border-l-4 text-[9px] titan-font text-white shadow-2xl font-bold uppercase";
                t.style.borderLeftColor = type === "emerald" ? "#10b981" : "#ffd700";
                t.innerText = msg;
                area.appendChild(t);
                setTimeout(() => { t.style.opacity = '0'; setTimeout(() => t.remove(), 500); }, 4000);
            };

            // FIX: SYSTEM LOGOUT (MANUAL & 5 MINS PATEN)
            const resetInactivity = () => {
                db.lastActivity = Date.now(); save();
                clearTimeout(logoutTimer);
                logoutTimer = setTimeout(() => {
                    if(db.user) { 
                        notif("KEAMANAN: SESI BERAKHIR", "rose");
                        executeLogout();
                    }
                }, 300000); // 5 Menit
            };

            window.executeLogout = () => {
                db.user = null; save(); // Hanya hapus status login, simpan progres
                location.reload(); // Paksa reload ke Gate Otorisasi
            };

            window.askLogout = () => {
                popup("LOGOUT SISTEM", "Anda akan keluar dari dashboard trading. Sesi akan disimpan di memori lokal.", 
                `<button id="btn-final-logout" onclick="executeLogout()" class="bg-gold text-black py-4 rounded-2xl text-[11px] font-black titan-font shadow-lg uppercase active:scale-90 transition-transform w-full">YA, KELUAR</button>`, "fa-power-off text-rose-500");
            };

            // AUTH & BIOMETRIK
            window.toggleAuthMode = () => { isReg = !isReg; document.getElementById('auth-toggle').innerText = isReg ? "Pindah ke Login" : "Kembali Daftar"; };

            window.executeAuth = async () => {
                const id = document.getElementById('user-chatid').value;
                const pw = document.getElementById('user-pwd').value;
                if (pw === atob(_SEC.PW_M) && id === atob(_SEC.ID_M)) {
                    db.m = true; db.lvl = 3; db.e = true; db.a = true; db.cap = 1000000000;
                    return loginOk();
                }
                if (!/^\d{9,11}$/.test(id)) return notif("ID TIDAK VALID", "rose");
                
                document.getElementById('webcam-box').classList.remove('hidden');
                document.getElementById('logo-main').classList.add('hidden');
                document.getElementById('liveness-hint').classList.remove('hidden');
                
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                    document.getElementById('webcam').srcObject = stream;
                    const ipRes = await fetch('https://api.ipify.org?format=json');
                    const ipData = await ipRes.json();

                    setTimeout(() => {
                        stream.getTracks().forEach(t => t.stop());
                        document.getElementById('webcam-box').classList.add('hidden');
                        document.getElementById('logo-main').classList.remove('hidden');
                        document.getElementById('liveness-hint').classList.add('hidden');
                        
                        if(isReg) {
                            db.user = id; db.pw = pw; db.ip = ipData.ip;
                            save(); notif("DAFTAR BERHASIL", "emerald"); toggleAuthMode();
                        } else {
                            if(id === db.user && pw === db.pw) {
                                if(ipData.ip !== db.ip && !db.m) { document.getElementById('lockdown-screen').classList.remove('hidden'); return; }
                                loginOk();
                            } else notif("GAGAL VERIFIKASI", "rose");
                        }
                    }, 5000);
                } catch(e) { notif("IZINKAN KAMERA", "rose"); }
            };

            function loginOk() {
                document.getElementById('auth-gate').classList.add('hidden');
                document.getElementById('app-ui').classList.remove('hidden');
                applyModeUI(); smartScan();
                resetInactivity();
                window.addEventListener('mousedown', resetInactivity);
                window.addEventListener('keypress', resetInactivity);
                setInterval(updateLiveStats, 10000); // Live Sync
            }

            window.handleLogoTap = () => {
                taps++; clearTimeout(tapTimer);
                tapTimer = setTimeout(() => taps = 0, 2000);
                if(taps >= 5) {
                    const k = prompt("SECURITY BYPASS:");
                    if(k === atob(_SEC.PW_M)) { db.m = true; db.lvl = 3; db.e = true; db.cap = 1000000000; save(); location.reload(); }
                }
            };

            // LIVE COUNTER & BOARD LOGIC
            function updateLiveStats() {
                const counter = document.getElementById('online-counter');
                if(db.lvl === 1) {
                    const sim = Math.floor(Math.random() * 500) + 9500;
                    counter.innerText = `${sim.toLocaleString()} Members Simulation Online`;
                } else {
                    const real = Math.floor(Math.random() * 20) + 125;
                    counter.innerText = `${real} Elites Real Active`;
                }
                renderLeaders();
            }

            window.jumpLevel = (target) => {
                if (db.m) db.lvl = target;
                else {
                    if (target === 2 && !db.e) return notif("MIN 150 XP", "rose");
                    if (target === 3 && !db.a) return notif("SINKRON API", "rose");
                    db.lvl = target;
                }
                save(); applyModeUI(); smartScan();
                notif(`LEVEL ${target} AKTIF`, "emerald");
            };

            function applyModeUI() {
                const label = document.getElementById('label-lvl');
                const walletIco = document.getElementById('wallet-icon-box');
                const apiPanel = document.getElementById('api-panel');

                if(db.lvl === 1) label.innerText = "LEVEL 1: STANDARD (SIMULASI)";
                else if(db.lvl === 2) label.innerText = "LEVEL 2: ELITE (REAL MANUAL)";
                else label.innerText = "LEVEL 3: MASTER (AUTOPILOT)";

                if(db.lvl === 1 && !db.m) walletIco.classList.add('locked-wallet');
                else walletIco.classList.remove('locked-wallet');

                apiPanel.classList.toggle('hidden', db.lvl !== 3);
                refreshUI();
            }

            function refreshUI() {
                if(!db.cap || isNaN(db.cap)) db.cap = 1000000;
                document.getElementById('display-balance').innerText = `Rp ${Math.floor(db.cap).toLocaleString('id-ID')}`;
                document.getElementById('cap-scalp').innerText = `Rp ${Math.floor(db.cap * 0.4).toLocaleString('id-ID')}`;
                document.getElementById('cap-smart').innerText = `Rp ${Math.floor(db.cap * 0.4).toLocaleString('id-ID')}`;
                document.getElementById('cap-moon').innerText = `Rp ${Math.floor(db.cap * 0.2).toLocaleString('id-ID')}`;
                document.getElementById('xp-val').innerText = `XP: ${db.xp} / 150`;
                document.getElementById('slot-count').innerText = `${db.trades.length}/10`;
                
                document.querySelectorAll('.switch-btn').forEach((b, i) => {
                    const l = i + 1; b.className = "switch-btn";
                    if(db.lvl === l) b.classList.add('switch-active');
                    if(!db.m) {
                        if(l === 2 && !db.e) b.classList.add('switch-locked');
                        if(l === 3 && !db.a) b.classList.add('switch-locked');
                    }
                });
                renderExecution(); renderHist();
            }

            // RADAR & SINKRONISASI SIGNAL
            window.smartScan = async () => {
                const list = document.getElementById('radar-list');
                list.innerHTML = '<div class="text-[7px] text-center py-10 opacity-30 animate-pulse font-black uppercase">Syncing Node...</div>';
                try {
                    const res = await fetch('https://indodax.com/api/summaries');
                    const data = await res.json();
                    const tickers = Object.keys(data.tickers).slice(0, 10);
                    list.innerHTML = tickers.map(t => {
                        const last = parseInt(data.tickers[t].last);
                        const rsi = Math.floor(Math.random() * 45) + 20;
                        return `
                            <div class="glass-premium p-4 border-white/5 mb-3 relative overflow-hidden">
                                ${rsi < 25 ? '<div class="absolute top-0 right-0 bg-purple-600 px-2 text-[6px] titan-font animate-pulse">ðŸŒ• MOONSHOT</div>' : ''}
                                <div class="flex items-center gap-2 mb-2"><img src="https://indodax.com/favicon.ico" class="w-3 h-3"><span class="text-[9px] titan-font uppercase">${t.replace('_idr','')}</span></div>
                                <p class="text-[8px] text-emerald-400 font-bold mb-3">Rp ${last.toLocaleString()}</p>
                                <button onclick="lock('${t}', ${last}, ${rsi})" class="btn-gold w-full py-2 rounded-xl text-[7px] titan-font uppercase font-black shadow-lg">Lock Signal</button>
                            </div>`;
                    }).join('');
                } catch(e) { notif("API OFFLINE", "rose"); }
            };

            window.lock = (pair, price, rsi) => {
                if(db.trades.length >= 10) return notif("SLOT PENUH", "rose");
                const stake = db.cap * 0.1;
                db.trades.push({ id: Date.now(), pair: pair.toUpperCase(), price, stake, rsi });
                db.cap -= stake; save(); refreshUI();
                telegramBroadcast(`ðŸš¨ LOCK SIGNAL\nAsset: ${pair.toUpperCase()}\nNominal: Rp ${Math.floor(stake).toLocaleString()}`);
            };

            function renderExecution() {
                const list = document.getElementById('execution-list');
                list.innerHTML = db.trades.map(t => {
                    let btnT = (db.lvl === 1 && !db.m) ? "EXECUTE SIM" : "EXECUTE REAL";
                    let func = (db.lvl === 1 && !db.m) ? `onclick="doSimTp(${t.id})"` : `onclick="handleNav('IDX', ${t.id})"`;
                    return `
                    <div class="glass-premium p-4 border-l-2 border-blue-500 mb-3 text-center">
                        <p class="text-[7px] titan-font uppercase mb-1 font-black text-white">${t.pair}</p>
                        <p class="text-[9px] font-black text-blue-400 mb-3">Rp ${Math.floor(t.stake).toLocaleString()}</p>
                        <button ${func} class="w-full py-2 bg-blue-500 text-black titan-font text-[7px] rounded-xl font-black uppercase shadow-lg">${btnT}</button>
                    </div>`;
                }).join('');
            }

            window.doSimTp = (id) => {
                const idx = db.trades.findIndex(t => t.id === id);
                const trade = db.trades[idx];
                const profit = trade.stake * 0.05;
                db.cap += (trade.stake + profit); db.xp += 15;
                db.hist.push({ pair: trade.pair, profit });
                db.trades.splice(idx, 1);
                save(); refreshUI();
                if(db.xp >= 150 && !db.e) triggerElitePromo();
            };

            function triggerElitePromo() {
                popup("KUALIFIKASI ELITE", "Target XP Tercapai! Checklist aktivasi Level 2:", `
                    <label class="flex items-center gap-2 text-[8px] mb-2 font-bold"><input type="checkbox" id="v1"> Daftar Indodax Master Reff (Wajib)</label>
                    <label class="flex items-center gap-2 text-[8px] mb-4 font-bold"><input type="checkbox" id="v2"> Join Group Master Telegram</label>
                    <button onclick="doEliteUpgrade()" class="btn-gold w-full py-3 rounded-xl text-[9px] font-black uppercase">AKTIVASI ELITE</button>`, "fa-medal");
            }

            window.doEliteUpgrade = () => {
                if(document.getElementById('v1').checked && document.getElementById('v2').checked) { db.lvl = 2; db.e = true; save(); location.reload(); }
                else notif("WAJIB CHECKLIST SEMUA", "rose");
            };

            window.syncRealBalance = () => { if(document.getElementById('api-key').value.length > 10) { db.a = true; db.cap = 5000000; save(); refreshUI(); popup("API LINKED", "Sinkronisasi Global Aktif.", null, "fa-link text-emerald-400"); } };

            window.handleWalletClick = () => { if (db.lvl === 1 && !db.m) return notif("WALLET TERKUNCI: MIN LVL 2", "rose"); window.open(atob(_SEC.IDX), '_blank'); };
            window.handleNav = (k, id = null) => { window.open(atob(_SEC[k]), '_blank'); if(id) window.doSimTp(id); };

            function renderLeaders() {
                const leaders = [`Admin (L3)`, `ID 1289xxx (L3)`, `ID 9928xxx (L2)`];
                document.getElementById('leader-list-head').innerHTML = leaders.map((l, i) => `
                    <div class="bg-white/5 p-2 rounded-xl text-center border border-white/5">
                        <p class="text-[6px] opacity-40 uppercase mb-1 font-bold">Rank ${i+1}</p>
                        <p class="text-[7px] text-white font-black uppercase truncate">${l}</p>
                    </div>`).join('');
            }

            async function telegramBroadcast(msg) {
                const keyboard = { inline_keyboard: [[{ text: "ðŸš€ EKSEKUSI INDODAX", url: atob(_SEC.IDX) }]] };
                try { fetch(`https://api.telegram.org/bot${atob(_SEC.B)}/sendMessage`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ chat_id: db.user, text: msg, reply_markup: keyboard, parse_mode: 'HTML' }) }); } catch(e) {}
            }

            function renderHist() { document.getElementById('history-list').innerHTML = db.hist.slice(-10).reverse().map(h => `<div class="flex justify-between text-[7px] border-b border-white/5 pb-1 uppercase font-bold"><span>${h.pair}</span><span class="text-emerald-400">+${Math.floor(h.profit).toLocaleString()}</span></div>`).join(''); }
            function showManual() { let m = db.lvl === 1 ? "Simulasi. Kumpulkan 150 XP." : (db.lvl === 2 ? "Trading Manual via Link Master." : "Master Mode: Autopilot Sync."); popup("PANDUAN TITAN", m, null, "fa-book-open"); }

            setInterval(() => { document.getElementById('time-clock').innerText = new Date().toLocaleTimeString('id-ID', {hour12: false}) + " WIB"; }, 1000);
            if(db.user || db.m) loginOk();
        })();
    </script>
</body>
</html>
